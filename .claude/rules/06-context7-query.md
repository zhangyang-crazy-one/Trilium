---
alwaysApply: true
description: "外部库查询规则 - 每次会话必须加载"
---

# 外部查询规则

> 加载时机：UserPromptSubmit（每次用户提交时评估）
> 适用范围：涉及不熟悉的库、API 或实现模式时

---

## Context7 查询

<context7_query>
当遇到不熟悉的库、API 或实现模式时，**必须**在继续之前查询外部文档。

### 查询触发条件（强制 MUST）

以下情况**必须**查询文档：

| 场景 | 说明 |
|------|------|
| 首次使用第三方库 | 不熟悉的库 |
| 库版本重大变化 | 主版本号变化 |
| 框架最佳实践不清楚 | 不确定推荐用法 |
| API 用法或参数不确定 | 复杂 API 配置 |
| 遇到废弃警告 | 需要迁移路径 |
| 首次实现的模式 | 在当前上下文中没写过 |

### 如何判断"不熟悉"

考虑查询的条件：

- 项目中首次使用该库
- 库版本 >= 主版本变更
- 复杂 API（> 5 个配置选项）
- 你对正确用法不确定
- 用户明确请求查阅文档

### 查询行为（强制 MUST）

| 阶段 | 行为 |
|------|------|
| 查询前 | 告知用户你正在查询文档 |
| 查询结果 | 简要引用来源和相关信息 |
| 查询失败 | 告警用户，在继续之前请求手动确认 |

### 工具优先级（强制 MUST）

查询外部资源时，使用以下优先级：

| 优先级 | 工具 | 用途 |
|--------|------|------|
| 1 | **Context7** | 官方文档（首选来源） |
| 2 | **deepwiki.com** | Context7 失败时的备选 |
| 3 | **GitHub** | 真实世界使用示例和问题解决方案 |

### 查询深度

| 场景 | 查询范围 |
|------|----------|
| 简单 API 用法 | 函数签名 + 示例代码 |
| 复杂功能实现 | 多个相关文档 + 最佳实践 |
| 架构决策 | 先查官方推荐模式，不足时再查社区最佳实践 |

### 信息冲突处理（强制 MUST）

| 情况 | 处理方式 |
|------|----------|
| 来源冲突 | **官方文档优先** |
| 信息不完整 | **在继续之前询问用户指导** |

### 查询示例

**场景**：用户要求使用 React Query v5

```
正在查询 React Query v5 官方文档...

根据 TanStack Query 文档：
- v5 移除了 `useQuery` 的对象语法
- 新语法：`useQuery({ queryKey: [...], queryFn: ... })`
- 缓存时间配置从 `cacheTime` 改为 `gcTime`

来源：https://tanstack.com/query/latest/docs/react/guides/migrating-to-v5
```

### 不需要查询的情况

- 熟悉的标准库 API
- 项目中已有使用示例
- 简单的 CRUD 操作
- 你确信了解正确用法
</context7_query>
