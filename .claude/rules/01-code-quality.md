---
alwaysApply: true
description: "代码质量验证规则 - 每次会话必须加载"
---

# 代码质量规则

> 加载时机：PreToolUse（使用 Write/Edit 工具前）
> 适用范围：所有代码修改操作

---

## 代码验证

<code_verification>
修改代码后必须进行验证，而不是之前。遵循以下验证工作流：

### 修改后验证（强制）

完成任何代码编辑后，**必须**：

1. 对所有修改的文件运行 `lsp_diagnostics`，检查 TypeScript/linting 错误
2. 在报告完成之前，验证不存在类型错误
3. 如果项目中存在构建命令，在重大更改后运行它

### 类型安全（强制 MUST）

| 禁止操作 | 说明 |
|----------|------|
| `as any` | **永远不要**使用来绕过类型检查 |
| `@ts-ignore` | **永远不要**使用此注释 |
| `@ts-expect-error` | **永远不要**使用此注释 |
| 未类型化变量 | **永远不要**在 TypeScript 文件中留下未类型化的变量或参数 |

**所有导出的函数和接口必须有显式的类型注解。**

### 验证失败协议

如果验证发现错误：

1. **立即修复**错误，然后再继续
2. 修复后**重新运行**验证
3. 只有在所有检查通过后才报告任务完成

### 验证检查清单

```
□ lsp_diagnostics 无错误
□ 无类型错误
□ 构建通过（如适用）
□ 测试通过（如适用）
```
</code_verification>

---

## 代码质量标准

<maintain_code_quality>
在处理代码编辑之前，始终阅读并理解相关文件。

### 编辑前检查

- 搜索代码中的关键事实，保持严格和持久
- 彻底审查代码库的风格、约定和抽象
- 理解现有模式后再实现新功能

### 质量保证要点

| 方面 | 要求 |
|------|------|
| 一致性 | 遵循现有代码风格 |
| 可读性 | 代码应该自解释 |
| 可维护性 | 考虑未来修改的便利性 |
| 测试性 | 代码应该易于测试 |
</maintain_code_quality>
