---
name: planning-with-files
description: "Manus 风格的文件规划技能。使用持久化 Markdown 文件作为'磁盘上的工作记忆'。用于复杂多步骤任务、研究项目或需要 >5 次工具调用的任务。触发词：任务、计划、planning、task、规划、项目、multi-step"
---

# Planning with Files - 文件规划技能

> **像 Manus 一样工作**: 使用持久化 Markdown 文件作为"磁盘上的工作记忆"

## 核心原则

```
Context Window = RAM (易失、有限)
Filesystem = Disk (持久、无限)

→ 任何重要信息都写入磁盘
```

## 快速开始

在开始任何复杂任务之前：

1. **创建 `planning/task_plan.md`** — 阶段跟踪
2. **创建 `planning/findings.md`** — 发现记录
3. **创建 `planning/progress.md`** — 进度日志
4. **决策前重读计划** — 刷新目标到注意力窗口
5. **每阶段后更新** — 标记完成，记录错误

## 文件用途

| 文件 | 用途 | 何时更新 |
|------|------|----------|
| `task_plan.md` | 阶段、进度、决策 | 每阶段完成后 |
| `findings.md` | 研究、发现 | 任何发现后 |
| `progress.md` | 会话日志、测试结果 | 整个会话中 |

## 关键规则

### 规则 1: 先创建计划

**非谈判**: 不创建 `task_plan.md` 绝不开始复杂任务。

### 规则 2: 2-Action 规则

> "每 2 次浏览/搜索操作后，立即将关键发现保存到文件"

这防止视觉/多模态信息丢失。

### 规则 3: 决策前阅读

在重大决策前，读取计划文件。这使目标保持在注意力窗口中。

### 规则 4: 行动后更新

完成任何阶段后：
- 标记阶段状态: `in_progress` → `complete`
- 记录遇到的错误
- 记录创建/修改的文件

### 规则 5: 记录所有错误

每个错误都记入计划文件。这建立知识并防止重复。

```markdown
## 遇到的错误
| 错误 | 尝试 | 解决方案 |
|------|------|----------|
| FileNotFoundError | 1 | 创建默认配置 |
| API timeout | 2 | 添加重试逻辑 |
```

### 规则 6: 永不重复失败

```python
if action_failed:
    next_action != same_action
```

跟踪尝试过的方法，变换方式。

## 3-Strike 错误协议

```
尝试 1: 诊断并修复
  → 仔细阅读错误
  → 识别根本原因
  → 应用针对性修复

尝试 2: 替代方法
  → 相同错误？尝试不同方法
  → 不同工具？不同库？
  → 绝不重复完全相同的失败操作

尝试 3: 更广泛的重新思考
  → 质疑假设
  → 搜索解决方案
  → 考虑更新计划

3次失败后: 上报用户
  → 解释尝试过什么
  → 分享具体错误
  → 请求指导
```

## 读取 vs 写入决策矩阵

| 情况 | 操作 | 原因 |
|------|------|------|
| 刚写入文件 | 不读取 | 内容仍在上下文中 |
| 查看图片/PDF | 立即写入发现 | 多模态→文本，在丢失前 |
| 浏览器返回数据 | 写入文件 | 截图不持久 |
| 开始新阶段 | 读取计划/发现 | 如果上下文陈旧则重新定向 |
| 发生错误 | 读取相关文件 | 需要当前状态来修复 |
| 间隔后恢复 | 读取所有规划文件 | 恢复状态 |

## 5-Question 重启测试

如果你能回答这些，你的上下文管理是可靠的：

| 问题 | 答案来源 |
|------|----------|
| 我在哪里？ | task_plan.md 中的当前阶段 |
| 我要去哪里？ | 剩余阶段 |
| 目标是什么？ | 计划中的目标陈述 |
| 我学到了什么？ | findings.md |
| 我做了什么？ | progress.md |

## 何时使用此模式

**使用于:**
- 多步骤任务 (3+ 步骤)
- 研究任务
- 构建/创建项目
- 跨多次工具调用的任务
- 任何需要组织的事情

**跳过于:**
- 简单问题
- 单文件编辑
- 快速查找

## 反模式

| 不要 | 改为 |
|------|------|
| 使用 TodoWrite 持久化 | 创建 task_plan.md 文件 |
| 陈述目标一次就忘记 | 决策前重读计划 |
| 隐藏错误并静默重试 | 将错误记录到计划文件 |
| 将所有内容塞入上下文 | 将大内容存储在文件中 |
| 立即开始执行 | 首先创建计划文件 |
| 重复失败的操作 | 跟踪尝试，变换方法 |

## 模板

使用以下模板开始：

- [templates/task_plan.md](templates/task_plan.md) — 阶段跟踪
- [templates/findings.md](templates/findings.md) — 研究存储
- [templates/progress.md](templates/progress.md) — 会话日志

## 与其他技能协同

| 技能 | 协同方式 |
|------|----------|
| **spec-interview** | 需求访谈结果记录到 findings.md |
| **react-frontend** | 前端任务阶段规划 |
| **electron-main** | 后端任务阶段规划 |
| **bug-debug** | 错误记录和解决跟踪 |
